import{r as a,n as k,x as T}from"./index-C2MjUc6j.js";import{s as m}from"./index-z1pI4DUj.js";const z=i=>{const[c,f]=a.useState("free"),[h,_]=a.useState("Free"),[o,A]=a.useState(!1),[u,d]=a.useState({prompts_per_month:1,prompts_per_feature:1,workflows:0,api_calls:0,team_members:1}),[g,w]=a.useState({basic_templates:!0,prompt_optimization:!0}),[S,l]=a.useState(!0),b=k(),{toast:P}=T();a.useEffect(()=>{i?q():l(!1)},[i]);const q=async()=>{try{l(!0);const{data:e}=await m.from("user_roles").select("role").eq("user_id",i).eq("role","admin").maybeSingle(),p=!!e;if(A(p),p){f("enterprise"),_("Admin"),d({prompts_per_month:-1,prompts_per_feature:-1,workflows:-1,api_calls:-1,team_members:-1}),w({basic_templates:!0,all_templates:!0,advanced_workflows:!0,compliance_checks:!0,team_collaboration:!0,priority_support:!0,custom_templates:!0,dedicated_support:!0,prompt_optimization:!0,sso:!0,sla:!0,custom_integrations:!0}),l(!1);return}const{data:t,error:s}=await m.from("user_subscriptions").select("plan_id").eq("user_id",i).eq("status","active").maybeSingle();if(s&&s.code!=="PGRST116")throw s;let r=m.from("subscription_plans").select("plan_type, plan_name, limits, features").eq("is_active",!0);t!=null&&t.plan_id?r=r.eq("id",t.plan_id):r=r.eq("plan_type","free");const{data:n,error:y}=await r.maybeSingle();if(y)throw y;n&&(f(n.plan_type),_(n.plan_name),d(n.limits),w(n.features))}catch(e){console.error("Error loading plan:",e)}finally{l(!1)}};return{planType:c,planName:h,limits:u,features:g,isLoading:S,canAccessFeature:e=>o?!0:g[e]===!0,canAccessWorkflows:()=>o?!0:u.workflows!==0,canAccessAgents:()=>o?!0:c!=="free"||u.prompts_per_month>0,hasProPlan:()=>o?!0:c!=="free",canUseFeature:async(e,p)=>{if(o||c!=="free")return!0;try{const t=new Date().toISOString().split("T")[0],{data:s,error:r}=await m.from("usage_tracking").select("id").eq("user_id",p).eq("feature",e).gte("timestamp",`${t}T00:00:00.000Z`).lt("timestamp",`${t}T23:59:59.999Z`);return r?(console.error("Error checking feature usage:",r),!1):((s==null?void 0:s.length)||0)<u.prompts_per_feature}catch(t){return console.error("Error in canUseFeature:",t),!1}},redirectToPricing:()=>{b("/pricing")},showUpgradeMessage:e=>{P({title:"Upgrade Required",description:`You've reached your limit for ${e}. Upgrade to continue using this feature.`,variant:"destructive"})}}};export{z as u};
