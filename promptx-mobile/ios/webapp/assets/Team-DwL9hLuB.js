import{c as Z,x as J,r,j as e,B as x,h as z,i as B,k as H,m as q,n as ee}from"./index-C2MjUc6j.js";import{s as i}from"./index-z1pI4DUj.js";import{I as Y}from"./index-C0NKCsYR.js";import{L as u}from"./label-CPXGueWk.js";import{T as E}from"./textarea-BKVa-xUV.js";import{B as K}from"./badge-BmD5Ofur.js";import{D as I,f as A,a as O,b as R,c as L,d as U}from"./dialog-D-kFK5f8.js";import{P as Q}from"./plus-XtvXWcDu.js";import{U as V}from"./index-BOT--vBY.js";import{T as se}from"./trash-2-DBuHC0nM.js";import{S as F}from"./star-CvJAy4g_.js";import{M as te}from"./message-square-BFiu9OZb.js";import{L as ae}from"./Layout-lstxxF2Q.js";import{T as re,a as ie,b as W,c as G}from"./tabs-CyOF3ppl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Z("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ne=({user:m})=>{const{toast:a}=J(),[c,b]=r.useState([]),[o,_]=r.useState(null),[d,h]=r.useState([]),[C,y]=r.useState(!1),[k,S]=r.useState(!1),[N,l]=r.useState(""),[j,w]=r.useState(""),[P,M]=r.useState("");r.useEffect(()=>{D()},[m]),r.useEffect(()=>{o&&s(o)},[o]);const D=async()=>{const{data:t}=await i.from("teams").select("*").eq("owner_id",m.id),{data:n}=await i.from("team_members").select("team_id, teams(*)").eq("user_id",m.id),v=[...t||[],...(n==null?void 0:n.map(T=>T.teams).filter(Boolean))||[]];b(v)},s=async t=>{const{data:n,error:v}=await i.from("team_members").select("*").eq("team_id",t);if(v){console.error("Error loading team members:",v);return}const T=await Promise.all((n||[]).map(async $=>{const{data:X}=await i.from("profiles").select("username, email").eq("id",$.user_id).single();return{...$,profiles:X}}));h(T)},p=async()=>{if(!N.trim()){a({title:"Name required",description:"Please provide a team name",variant:"destructive"});return}const{error:t}=await i.from("teams").insert({name:N,description:j,owner_id:m.id});if(t){a({title:"Error creating team",description:t.message,variant:"destructive"});return}a({title:"Team created",description:"Your team has been created successfully"}),l(""),w(""),y(!1),D()},g=async()=>{if(!o||!P.trim()){a({title:"Invalid input",description:"Please select a team and enter an email",variant:"destructive"});return}const{data:t}=await i.from("profiles").select("id").eq("email",P).single();if(!t){a({title:"User not found",description:"No user found with this email",variant:"destructive"});return}const{error:n}=await i.from("team_members").insert({team_id:o,user_id:t.id,role:"member"});if(n){a({title:"Error inviting member",description:n.message,variant:"destructive"});return}a({title:"Member invited",description:"Team member has been added successfully"}),M(""),S(!1),s(o)},f=async t=>{const{error:n}=await i.from("team_members").delete().eq("id",t);if(n){a({title:"Error removing member",description:n.message,variant:"destructive"});return}a({title:"Member removed",description:"Team member has been removed"}),o&&s(o)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Team Collaboration"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your teams and collaborate on prompts"})]}),e.jsxs(I,{open:C,onOpenChange:y,children:[e.jsx(A,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Create Team"]})}),e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(L,{children:"Create New Team"}),e.jsx(U,{children:"Create a team to collaborate with others on prompts"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Team Name"}),e.jsx(Y,{value:N,onChange:t=>l(t.target.value),placeholder:"My Team"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Description (optional)"}),e.jsx(E,{value:j,onChange:t=>w(t.target.value),placeholder:"What's this team for?",rows:3})]}),e.jsx(x,{onClick:p,className:"w-full",children:"Create Team"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(z,{className:"md:col-span-1",children:[e.jsx(B,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Your Teams"]})}),e.jsx(q,{children:e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No teams yet"}):c.map(t=>e.jsxs(x,{variant:o===t.id?"default":"outline",className:"w-full justify-start",onClick:()=>_(t.id),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),t.name]},t.id))})})]}),o&&e.jsxs(z,{className:"md:col-span-2",children:[e.jsx(B,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:"Team Members"}),e.jsxs(I,{open:k,onOpenChange:S,children:[e.jsx(A,{asChild:!0,children:e.jsxs(x,{size:"sm",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Invite Member"]})}),e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(L,{children:"Invite Team Member"}),e.jsx(U,{children:"Invite someone to join your team by their email"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Email Address"}),e.jsx(Y,{type:"email",value:P,onChange:t=>M(t.target.value),placeholder:"user@example.com"})]}),e.jsx(x,{onClick:g,className:"w-full",children:"Send Invite"})]})]})]})]})}),e.jsx(q,{children:e.jsx("div",{className:"space-y-3",children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No members yet"}):d.map(t=>{var n,v,T;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((n=t.profiles)==null?void 0:n.username)||((v=t.profiles)==null?void 0:v.email)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(T=t.profiles)==null?void 0:T.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{children:t.role}),t.user_id!==m.id&&e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f(t.id),children:e.jsx(se,{className:"h-4 w-4"})})]})]},t.id)})})})]})]})]})},oe=({user:m,teamId:a})=>{const{toast:c}=J(),[b,o]=r.useState([]),[_,d]=r.useState(!1),[h,C]=r.useState(null),[y,k]=r.useState(5),[S,N]=r.useState(""),[l,j]=r.useState({title:"",original_prompt:"",optimized_prompt:"",platform:"chatgpt",category:"general"});r.useEffect(()=>{w();const s=i.channel("team-prompts-changes").on("postgres_changes",{event:"*",schema:"public",table:"team_prompts",filter:`team_id=eq.${a}`},p=>{console.log("Team prompt change:",p),w()}).subscribe();return()=>{i.removeChannel(s)}},[a]);const w=async()=>{const{data:s,error:p}=await i.from("team_prompts").select("*").eq("team_id",a).order("created_at",{ascending:!1});if(p){console.error("Error loading prompts:",p);return}const g=await Promise.all((s||[]).map(async f=>{const{data:t}=await i.from("profiles").select("username, email").eq("id",f.created_by).single(),{data:n}=await i.from("prompt_ratings").select("*").eq("prompt_id",f.id);return{...f,creator_profile:t,ratings:n||[]}}));o(g)},P=async()=>{if(!l.title||!l.original_prompt){c({title:"Missing fields",description:"Please fill in title and prompt",variant:"destructive"});return}const{error:s}=await i.from("team_prompts").insert({team_id:a,created_by:m.id,title:l.title,original_prompt:l.original_prompt,optimized_prompt:l.optimized_prompt,platform:l.platform,category:l.category});if(s){c({title:"Error creating prompt",description:s.message,variant:"destructive"});return}c({title:"Prompt shared",description:"Your prompt has been shared with the team"}),j({title:"",original_prompt:"",optimized_prompt:"",platform:"chatgpt",category:"general"}),d(!1)},M=async()=>{if(!h)return;const{error:s}=await i.from("prompt_ratings").upsert({prompt_id:h.id,user_id:m.id,rating:y,review:S});if(s){c({title:"Error submitting rating",description:s.message,variant:"destructive"});return}c({title:"Rating submitted",description:"Thank you for your feedback"}),k(5),N(""),C(null),w()},D=s=>!s||s.length===0?0:(s.reduce((p,g)=>p+g.rating,0)/s.length).toFixed(1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Team Prompts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Collaborate and share prompts with your team"})]}),e.jsxs(I,{open:_,onOpenChange:d,children:[e.jsx(A,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Share Prompt"]})}),e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx(L,{children:"Share Prompt with Team"}),e.jsx(U,{children:"Share your prompt for team collaboration and feedback"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Title"}),e.jsx(Y,{value:l.title,onChange:s=>j({...l,title:s.target.value}),placeholder:"Prompt title"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Original Prompt"}),e.jsx(E,{value:l.original_prompt,onChange:s=>j({...l,original_prompt:s.target.value}),placeholder:"Your prompt...",rows:4})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Optimized Version (optional)"}),e.jsx(E,{value:l.optimized_prompt,onChange:s=>j({...l,optimized_prompt:s.target.value}),placeholder:"Improved version...",rows:4})]}),e.jsx(x,{onClick:P,className:"w-full",children:"Share with Team"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.length===0?e.jsx(z,{className:"col-span-full",children:e.jsxs(q,{className:"py-12 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No team prompts yet"})]})}):b.map(s=>{var p,g,f;return e.jsxs(z,{children:[e.jsx(B,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{className:"line-clamp-1",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["by ",((p=s.creator_profile)==null?void 0:p.username)||((g=s.creator_profile)==null?void 0:g.email)]})]}),e.jsx(K,{children:s.platform})]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm line-clamp-3",children:s.original_prompt})}),s.optimized_prompt&&e.jsxs("div",{className:"p-3 bg-primary/5 border border-primary/20 rounded-md",children:[e.jsx(u,{className:"text-xs text-primary mb-1 block",children:"Optimized"}),e.jsx("p",{className:"text-sm line-clamp-3",children:s.optimized_prompt})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium",children:D(s.ratings||[])}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",((f=s.ratings)==null?void 0:f.length)||0," ratings)"]})]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>C(s),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Rate"]})]})]})]},s.id)})}),e.jsx(I,{open:!!h,onOpenChange:()=>C(null),children:e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(L,{children:"Rate Prompt"}),e.jsx(U,{children:"Share your feedback with the team"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Rating (1-5 stars)"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(s=>e.jsx(x,{variant:y>=s?"default":"outline",size:"icon",onClick:()=>k(s),children:e.jsx(F,{className:`h-4 w-4 ${y>=s?"fill-current":""}`})},s))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Review (optional)"}),e.jsx(E,{value:S,onChange:s=>N(s.target.value),placeholder:"Share your thoughts...",rows:3})]}),e.jsx(x,{onClick:M,className:"w-full",children:"Submit Rating"})]})]})})]})},we=()=>{const m=ee(),[a,c]=r.useState(null),[b,o]=r.useState(!0);return r.useEffect(()=>{const{data:{subscription:_}}=i.auth.onAuthStateChange((d,h)=>{c((h==null?void 0:h.user)??null),h||m("/auth")});return i.auth.getSession().then(({data:{session:d}})=>{c((d==null?void 0:d.user)??null),d||m("/auth"),o(!1)}),()=>_.unsubscribe()},[m]),b?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-pulse-subtle",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsx(ae,{user:a,showHeader:!1,children:e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-b from-background via-background to-muted/20",children:e.jsxs("div",{className:"container-responsive mx-auto max-w-6xl py-8 sm:py-12 md:py-16 lg:py-20",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 md:mb-10 lg:mb-12 space-y-2 sm:space-y-3 md:space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-foreground leading-[1.1] tracking-tight animate-fade-in",children:"Team Management"}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg lg:text-xl text-muted-foreground max-w-2xl leading-relaxed",children:"Collaborate with your team, manage members, and share prompt resources"})]}),e.jsxs(re,{defaultValue:"management",className:"w-full space-y-6 sm:space-y-8 md:space-y-10",children:[e.jsx("div",{className:"flex justify-center overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsxs(ie,{className:"inline-flex h-11 sm:h-12 md:h-14 items-center justify-center rounded-xl bg-muted/50 p-1.5 text-muted-foreground backdrop-blur-sm border border-border/50 shadow-lg",children:[e.jsx(W,{value:"management",className:"px-3 sm:px-6 md:px-8 py-2 sm:py-2.5 md:py-3 rounded-lg text-sm sm:text-base font-semibold whitespace-nowrap",children:"Team Members"}),e.jsx(W,{value:"collaboration",className:"px-3 sm:px-6 md:px-8 py-2 sm:py-2.5 md:py-3 rounded-lg text-sm sm:text-base font-semibold whitespace-nowrap",children:"Collaboration"})]})}),e.jsx(G,{value:"management",className:"mt-0 space-y-6",children:e.jsx(ne,{user:a})}),e.jsx(G,{value:"collaboration",className:"mt-0 space-y-6",children:e.jsx(oe,{user:a,teamId:(a==null?void 0:a.id)||""})})]})]})})})};export{we as default};
