import{r as l,x as S,j as e,h as E,i as q,k as L,l as B,m as H,B as u,q as M}from"./index-C2MjUc6j.js";import{I as R}from"./index-C0NKCsYR.js";import{L as z}from"./label-CPXGueWk.js";import{B as j}from"./badge-BmD5Ofur.js";import{T as F,a as O,b as N,c as o,d as U,e as c,A as $,f as G,g as J,h as Q,i as V,j as W,k as X,l as Y}from"./alert-dialog-BE3E0pZr.js";import{s as h}from"./index-z1pI4DUj.js";import{K as Z}from"./Layout-lstxxF2Q.js";import{T as ee}from"./trash-2-DBuHC0nM.js";function ce({user:i}){const[g,k]=l.useState([]),[p,_]=l.useState(""),[f,A]=l.useState(!1),[x,m]=l.useState(null);l.useState(new Set);const[s,w]=l.useState(null),{toast:n}=S();l.useEffect(()=>{i&&y()},[i]);const y=async()=>{try{const{data:t,error:a}=await h.from("api_keys").select("id, key_name, api_key_hash, key_prefix, is_active, requests_count, rate_limit_per_hour, last_used_at, expires_at, last_rotated_at, created_at").eq("user_id",i==null?void 0:i.id).order("created_at",{ascending:!1});if(a)throw a;k((t||[]).map(r=>({...r,api_key:null})))}catch(t){n({title:"Error loading API keys",description:t.message,variant:"destructive"})}},D=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="pk_";for(let r=0;r<32;r++)a+=t.charAt(Math.floor(Math.random()*t.length));return a},C=async()=>{if(!p.trim()){n({title:"Name required",description:"Please enter a name for your API key",variant:"destructive"});return}A(!0);try{const t=D(),a=t.substring(0,12),{data:r,error:d}=await h.rpc("generate_api_key_hash",{_api_key:t});if(d)throw d;const{data:P,error:v}=await h.from("api_keys").insert({user_id:i==null?void 0:i.id,key_name:p,api_key:t,api_key_hash:r,key_prefix:a,expires_at:new Date(Date.now()+365*24*60*60*1e3).toISOString()}).select("id").single();if(v)throw v;w({id:P.id,plaintext_key:t}),n({title:"API key created",description:"⚠️ Copy this key now - you won't be able to see it again!"}),_(""),y()}catch(t){n({title:"Error creating API key",description:t.message,variant:"destructive"})}finally{A(!1)}},I=async()=>{if(x)try{const{error:t}=await h.from("api_keys").delete().eq("id",x);if(t)throw t;n({title:"API key deleted",description:"The API key has been removed"}),y()}catch(t){n({title:"Error deleting API key",description:t.message,variant:"destructive"})}finally{m(null)}},b=t=>{navigator.clipboard.writeText(t),n({title:"Copied",description:"API key copied to clipboard"})},K=(t,a)=>(s==null?void 0:s.id)===t?s.plaintext_key:a?`${a}${"•".repeat(24)}`:"••••••••••••••••••••••••••••••••••••",T=t=>(s==null?void 0:s.id)===t.id?s.plaintext_key:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs(q,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"API Key Management"]}),e.jsx(B,{children:"Create and manage API keys to integrate our prompt optimization engine into your applications"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"keyName",children:"Create New API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{id:"keyName",placeholder:"Enter a name for your API key",value:p,onChange:t=>_(t.target.value)}),e.jsx(u,{onClick:C,disabled:f,children:f?"Creating...":"Create Key"})]})]})}),g.length>0?e.jsx("div",{className:"border rounded-lg",children:e.jsxs(F,{children:[e.jsx(O,{children:e.jsxs(N,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"API Key"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Requests"}),e.jsx(o,{children:"Rate Limit"}),e.jsx(o,{children:"Last Used"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(U,{children:g.map(t=>{const a=T(t),r=(s==null?void 0:s.id)===t.id,d=t.expires_at&&new Date(t.expires_at)<new Date;return e.jsxs(N,{className:r?"bg-accent/50":"",children:[e.jsxs(c,{className:"font-medium",children:[t.key_name,d&&e.jsx(j,{variant:"destructive",className:"ml-2 text-xs",children:"Expired"})]}),e.jsx(c,{className:"font-mono text-sm",children:e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:a}),e.jsx(j,{variant:"outline",className:"text-xs",children:"Copy now - shown once!"})]}):K(t.id,t.key_prefix)})}),e.jsx(c,{children:e.jsx(j,{variant:t.is_active&&!d?"default":"secondary",children:d?"Expired":t.is_active?"Active":"Inactive"})}),e.jsx(c,{children:t.requests_count.toLocaleString()}),e.jsxs(c,{children:[t.rate_limit_per_hour,"/hour"]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:t.last_used_at?new Date(t.last_used_at).toLocaleDateString():"Never"}),t.expires_at&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expires: ",new Date(t.expires_at).toLocaleDateString()]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[a&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>b(a),children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>m(t.id),children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},t.id)})})]})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No API keys created yet. Create your first key to get started."})]})]}),e.jsx($,{open:!!x,onOpenChange:()=>m(null),children:e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Delete API Key"}),e.jsx(V,{children:"Are you sure you want to delete this API key? This action cannot be undone and any applications using this key will stop working."})]}),e.jsxs(W,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Y,{onClick:I,children:"Delete"})]})]})})]})}export{ce as A};
