import{r as N,x as Q,j as s,h as T,i as R,k as X,l as I,m as S,B as D,q as $,n as V}from"./index-C2MjUc6j.js";import{s as j}from"./index-z1pI4DUj.js";import{H as U,L as J}from"./Layout-lstxxF2Q.js";import{B as K}from"./badge-BmD5Ofur.js";import{S as Z}from"./SocialShare-Ds_WculW.js";import{a as z}from"./index-BOT--vBY.js";import{C as A}from"./clock-BofKCsJM.js";import{t as w,b as P,c as O,g as E,d as tt,f as F,e as et}from"./en-US-CXXYYhpC.js";import{S as rt}from"./star-CvJAy4g_.js";import"./index-C0NKCsYR.js";import"./dialog-D-kFK5f8.js";import"./share-2-ceq3zW03.js";import"./send-Bprvxut_.js";import"./circle-check-big-BtjQXCTU.js";function v(e,t){var d,f,g,i;const r=P(),n=(t==null?void 0:t.weekStartsOn)??((f=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:f.weekStartsOn)??r.weekStartsOn??((i=(g=r.locale)==null?void 0:g.options)==null?void 0:i.weekStartsOn)??0,a=w(e),o=a.getDay(),u=(o<n?7:0)+o-n;return a.setDate(a.getDate()-u),a.setHours(0,0,0,0),a}function Y(e){return v(e,{weekStartsOn:1})}function L(e){const t=w(e),r=t.getFullYear(),n=O(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const a=Y(n),o=O(e,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const u=Y(o);return t.getTime()>=a.getTime()?r+1:t.getTime()>=u.getTime()?r:r-1}function C(e){const t=w(e);return t.setHours(0,0,0,0),t}function nt(e,t){const r=C(e),n=C(t),a=+r-E(r),o=+n-E(n);return Math.round((a-o)/tt)}function at(e){const t=L(e),r=O(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),Y(r)}function st(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function ot(e){if(!st(e)&&typeof e!="number")return!1;const t=w(e);return!isNaN(Number(t))}function it(e){const t=w(e),r=O(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ct(e){const t=w(e);return nt(t,it(t))+1}function ut(e){const t=w(e),r=+Y(t)-+at(t);return Math.round(r/F)+1}function G(e,t){var i,l,x,p;const r=w(e),n=r.getFullYear(),a=P(),o=(t==null?void 0:t.firstWeekContainsDate)??((l=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:l.firstWeekContainsDate)??a.firstWeekContainsDate??((p=(x=a.locale)==null?void 0:x.options)==null?void 0:p.firstWeekContainsDate)??1,u=O(e,0);u.setFullYear(n+1,0,o),u.setHours(0,0,0,0);const d=v(u,t),f=O(e,0);f.setFullYear(n,0,o),f.setHours(0,0,0,0);const g=v(f,t);return r.getTime()>=d.getTime()?n+1:r.getTime()>=g.getTime()?n:n-1}function dt(e,t){var d,f,g,i;const r=P(),n=(t==null?void 0:t.firstWeekContainsDate)??((f=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((i=(g=r.locale)==null?void 0:g.options)==null?void 0:i.firstWeekContainsDate)??1,a=G(e,t),o=O(e,0);return o.setFullYear(a,0,n),o.setHours(0,0,0,0),v(o,t)}function lt(e,t){const r=w(e),n=+v(r,t)-+dt(r,t);return Math.round(n/F)+1}function c(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const y={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return c(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):c(r+1,2)},d(e,t){return c(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return c(e.getHours()%12||12,t.length)},H(e,t){return c(e.getHours(),t.length)},m(e,t){return c(e.getMinutes(),t.length)},s(e,t){return c(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),a=Math.trunc(n*Math.pow(10,r-3));return c(a,t.length)}},k={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},W={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return y.y(e,t)},Y:function(e,t,r,n){const a=G(e,n),o=a>0?a:1-a;if(t==="YY"){const u=o%100;return c(u,2)}return t==="Yo"?r.ordinalNumber(o,{unit:"year"}):c(o,t.length)},R:function(e,t){const r=L(e);return c(r,t.length)},u:function(e,t){const r=e.getFullYear();return c(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return c(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return c(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return y.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return c(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const a=lt(e,n);return t==="wo"?r.ordinalNumber(a,{unit:"week"}):c(a,t.length)},I:function(e,t,r){const n=ut(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):c(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):y.d(e,t)},D:function(e,t,r){const n=ct(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):c(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const a=e.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return c(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});case"eeee":default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const a=e.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return c(o,t.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});case"cccc":default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),a=n===0?7:n;switch(t){case"i":return String(a);case"ii":return c(a,t.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let a;switch(n===12?a=k.noon:n===0?a=k.midnight:a=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let a;switch(n>=17?a=k.evening:n>=12?a=k.afternoon:n>=4?a=k.morning:a=k.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return y.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):y.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):c(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):c(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):y.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):y.s(e,t)},S:function(e,t){return y.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return q(n);case"XXXX":case"XX":return b(n);case"XXXXX":case"XXX":default:return b(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return q(n);case"xxxx":case"xx":return b(n);case"xxxxx":case"xxx":default:return b(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+H(n,":");case"OOOO":default:return"GMT"+b(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+H(n,":");case"zzzz":default:return"GMT"+b(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return c(n,t.length)},T:function(e,t,r){const n=e.getTime();return c(n,t.length)}};function H(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),o=n%60;return o===0?r+String(a):r+String(a)+t+c(o,2)}function q(e,t){return e%60===0?(e>0?"-":"+")+c(Math.abs(e)/60,2):b(e,t)}function b(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),a=c(Math.trunc(n/60),2),o=c(n%60,2);return r+a+t+o}const _=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},B=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},ft=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return _(e,t);let o;switch(n){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",_(n,t)).replace("{{time}}",B(a,t))},mt={p:B,P:ft},ht=/^D+$/,gt=/^Y+$/,xt=["D","DD","YY","YYYY"];function wt(e){return ht.test(e)}function pt(e){return gt.test(e)}function yt(e,t,r){const n=bt(e,t,r);if(console.warn(n),xt.includes(e))throw new RangeError(n)}function bt(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ot=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,kt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Nt=/^'([^]*?)'?$/,vt=/''/g,jt=/[a-zA-Z]/;function Yt(e,t,r){var i,l,x,p;const n=P(),a=n.locale??et,o=n.firstWeekContainsDate??((l=(i=n.locale)==null?void 0:i.options)==null?void 0:l.firstWeekContainsDate)??1,u=n.weekStartsOn??((p=(x=n.locale)==null?void 0:x.options)==null?void 0:p.weekStartsOn)??0,d=w(e);if(!ot(d))throw new RangeError("Invalid time value");let f=t.match(kt).map(h=>{const m=h[0];if(m==="p"||m==="P"){const M=mt[m];return M(h,a.formatLong)}return h}).join("").match(Ot).map(h=>{if(h==="''")return{isToken:!1,value:"'"};const m=h[0];if(m==="'")return{isToken:!1,value:Pt(h)};if(W[m])return{isToken:!0,value:h};if(m.match(jt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:h}});a.localize.preprocessor&&(f=a.localize.preprocessor(d,f));const g={firstWeekContainsDate:o,weekStartsOn:u,locale:a};return f.map(h=>{if(!h.isToken)return h.value;const m=h.value;(pt(m)||wt(m))&&yt(m,t,String(e));const M=W[m[0]];return M(d,m,a.localize,g)}).join("")}function Pt(e){const t=e.match(Nt);return t?t[1].replace(vt,"'"):e}const Mt=({userId:e,onPromptSelect:t})=>{const[r,n]=N.useState([]),[a,o]=N.useState(!1),{toast:u}=Q();N.useEffect(()=>{d()},[e]);const d=async()=>{o(!0);try{const{data:i,error:l}=await j.from("prompt_history").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(10);if(l)throw l;n(i||[])}catch(i){console.error("Error loading history:",i)}finally{o(!1)}},f=async(i,l)=>{try{const{error:x}=await j.from("prompt_history").update({rating:l}).eq("id",i);if(x)throw x;n(r.map(p=>p.id===i?{...p,rating:l}:p)),u({title:"âœ… Rating Saved",description:"Thanks for the feedback! PromptX will learn from this."})}catch(x){u({title:"Error Saving Rating",description:x.message,variant:"destructive"})}},g=async i=>{try{await navigator.clipboard.writeText(i),u({title:"Copied!",description:"Prompt copied to clipboard"})}catch{u({title:"Failed to copy",variant:"destructive"})}};return s.jsxs(T,{className:"bg-gradient-to-br from-background to-secondary/5 border-primary/20",children:[s.jsxs(R,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"h-5 w-5 text-primary"}),s.jsx(X,{children:"Prompt History & Learning"})]}),s.jsx(I,{children:"Your past prompts help PromptX learn your style and improve over time"})]}),s.jsx(S,{children:a?s.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading history..."}):r.length===0?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"No history yet. Generate some prompts to start learning!"})]}):s.jsx("div",{className:"space-y-3 max-h-[500px] overflow-y-auto pr-2",children:r.map(i=>s.jsx(T,{className:"border-secondary/50",children:s.jsx(S,{className:"p-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-3 w-3 text-muted-foreground"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:Yt(new Date(i.created_at),"MMM d, yyyy - h:mm a")})]}),s.jsx(K,{variant:"outline",className:"text-xs",children:i.platform})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Original:"}),s.jsx("p",{className:"text-sm text-foreground/80 line-clamp-2",children:i.original_prompt})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Optimized:"}),s.jsx("p",{className:"text-sm line-clamp-3",children:i.optimized_prompt})]})]}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[s.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(l=>s.jsx("button",{onClick:()=>f(i.id,l),className:"focus:outline-none",children:s.jsx(rt,{className:`h-4 w-4 ${i.rating&&l<=i.rating?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`})},l))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(D,{variant:"ghost",size:"sm",onClick:()=>g(i.optimized_prompt),children:s.jsx($,{className:"h-3 w-3"})}),s.jsx(D,{variant:"ghost",size:"sm",onClick:()=>t(i.original_prompt),children:"Reuse"}),s.jsx(Z,{title:`Check out my ${i.platform} prompt!`,description:i.optimized_prompt.substring(0,150)+"..."})]})]})]})})},i.id))})})]})},Rt=()=>{const e=V(),[t,r]=N.useState(null),[n,a]=N.useState(!0);return N.useEffect(()=>{const{data:{subscription:o}}=j.auth.onAuthStateChange((u,d)=>{r((d==null?void 0:d.user)??null),d||e("/auth")});return j.auth.getSession().then(({data:{session:u}})=>{r((u==null?void 0:u.user)??null),u||e("/auth"),a(!1)}),()=>o.unsubscribe()},[e]),n?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:s.jsx("div",{className:"animate-pulse-subtle",children:s.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):s.jsx(J,{user:t,showHeader:!1,children:s.jsx("div",{className:"w-full min-h-screen bg-gradient-to-b from-background via-background to-muted/20",children:s.jsxs("div",{className:"container-responsive mx-auto max-w-6xl py-8 sm:py-12 md:py-16 lg:py-20",children:[s.jsxs("div",{className:"mb-6 sm:mb-8 md:mb-10 lg:mb-12 space-y-2 sm:space-y-3 md:space-y-4",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:"Prompt History"}),s.jsx("p",{className:"text-sm sm:text-base md:text-lg lg:text-xl text-muted-foreground max-w-2xl leading-relaxed",children:"View and manage your previously created prompts"})]}),s.jsx("div",{className:"w-full",children:s.jsx(Mt,{userId:(t==null?void 0:t.id)||"",onPromptSelect:()=>{}})})]})})})};export{Rt as default};
