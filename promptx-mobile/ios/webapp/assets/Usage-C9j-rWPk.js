import{c as Q,r as l,x as J,n as z,j as e,B as S,h as w,i as k,k as C,m as _,l as I}from"./index-C2MjUc6j.js";import{s as b}from"./index-z1pI4DUj.js";import{L as X}from"./Layout-lstxxF2Q.js";import{P as ee}from"./progress-Dbp9893P.js";import{B as r}from"./badge-BmD5Ofur.js";import{u as K}from"./usePlanAccess-D5vvazVe.js";import{R as se}from"./refresh-cw-D-B7VL-M.js";import{Z as P,a as te,b as ae}from"./index-BOT--vBY.js";import{A as re}from"./activity-CcWScsmI.js";import{S as ie}from"./shield-BU0WWken.js";import{C as ne}from"./clock-BofKCsJM.js";import"./index-C0NKCsYR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=Q("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),le=(a,t)=>{const[p,s]=l.useState(!0),[h,u]=l.useState(0),[m,n]=l.useState(!0),{toast:T}=J(),U=z(),d=K(t);l.useEffect(()=>{t&&!d.isLoading&&i()},[t,a,d.isLoading]);const i=async()=>{if(!t){s(!1),n(!1);return}if(d.hasProPlan()){s(!0),u(0),n(!1);return}try{n(!0);const c=new Date().toISOString().split("T")[0],{data:f,error:N}=await b.from("usage_tracking").select("id, timestamp").eq("user_id",t).eq("feature",a).gte("timestamp",`${c}T00:00:00.000Z`).lt("timestamp",`${c}T23:59:59.999Z`).order("timestamp",{ascending:!1});if(N){console.error("Error checking usage:",N),s(!1);return}const o=(f==null?void 0:f.length)||0;u(o);const A=d.limits.prompts_per_feature;s(o<A)}catch(c){console.error("Error in checkUsage:",c),s(!1)}finally{n(!1)}},L=async()=>{if(!t)return!1;if(d.hasProPlan())return!0;if(!p)return y(),!1;try{const{error:c}=await b.from("usage_tracking").insert({user_id:t,feature:a,timestamp:new Date().toISOString(),metadata:{plan_type:d.planType,usage_count:h+1}});if(c)return console.error("Error tracking usage:",c),T({title:"Error",description:"Failed to track usage. Please try again.",variant:"destructive"}),!1;const f=h+1;u(f);const N=d.limits.prompts_per_feature,o=f<N;return s(o),o||setTimeout(()=>y(),1e3),!0}catch(c){return console.error("Error in trackUsage:",c),!1}},y=()=>{T({title:"Feature Limit Reached",description:`You've used your daily limit for ${a}. Upgrade to Pro for unlimited access!`,variant:"destructive"}),setTimeout(()=>{U("/pricing")},2e3)};return{canUse:p,usageCount:h,isLoading:m,checkUsage:i,trackUsage:L,showUpgradePrompt:y}};function ce({user:a}){var A,D,$,R,Y,q,F,Z,B,M,O,G,W;const[t,p]=l.useState(null),[s,h]=l.useState(null),[u,m]=l.useState(!0),[n,T]=l.useState(!1),{toast:U}=J(),d=z(),i=K(a==null?void 0:a.id),L=le("prompt_generation",a==null?void 0:a.id);l.useEffect(()=>{a&&y()},[a]);const y=async()=>{try{const{data:x,error:g}=await b.from("user_subscriptions").select("*, subscription_plans(*)").eq("user_id",a==null?void 0:a.id).eq("status","active").maybeSingle();if(g&&g.code!=="PGRST116")throw g;if(x)h(x.subscription_plans);else{const{data:j,error:v}=await b.from("subscription_plans").select("*").eq("plan_type","free").single();if(v)throw v;h(j)}if(i.planType==="free"){const j=new Date().toISOString().split("T")[0],{data:v,error:H}=await b.from("usage_tracking").select("id").eq("user_id",a==null?void 0:a.id).eq("feature","prompt_generation").gte("timestamp",`${j}T00:00:00.000Z`).lt("timestamp",`${j}T23:59:59.999Z`);if(H)throw H;const E=(v==null?void 0:v.length)||0;p({limit:1,used:E,remaining:Math.max(0,1-E),has_access:E<1})}else p({limit:-1,used:0,remaining:-1,has_access:!0})}catch(x){console.error("Error loading usage:",x),U({title:"Error loading usage data",description:x.message,variant:"destructive"})}finally{m(!1)}},c=(x,g)=>g===-1?0:Math.min(x/g*100,100),f=(x,g)=>{if(g===-1)return"text-primary";const j=x/g*100;return j>=90?"text-destructive":j>=75?"text-warning":"text-primary"},N=async()=>{T(!0),await y(),await L.checkUsage(),T(!1),U({title:"Updated",description:"Usage data refreshed successfully"})},o=()=>{d("/pricing")};return u?e.jsx("div",{className:"text-center py-8",children:"Loading usage data..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Usage Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track your subscription and usage"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:N,disabled:n,children:[e.jsx(se,{className:`w-4 h-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]}),(s==null?void 0:s.plan_type)==="free"&&e.jsxs(S,{variant:"default",size:"sm",onClick:o,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Upgrade Plan"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(w,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Current Plan"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.plan_name)||"Free"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",(s==null?void 0:s.price_monthly)||0,"/month"]})]})]}),e.jsxs(w,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:i.planType==="free"?"Daily Prompts":"Prompts Used"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsxs("div",{className:`text-2xl font-bold ${f((t==null?void 0:t.used)||0,(t==null?void 0:t.limit)||0)}`,children:[(t==null?void 0:t.used)||0,(t==null?void 0:t.limit)!==-1&&` / ${t==null?void 0:t.limit}`]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(t==null?void 0:t.limit)===-1?"Unlimited":i.planType==="free"?`${(t==null?void 0:t.remaining)||0} remaining today`:`${(t==null?void 0:t.remaining)||0} remaining this month`})]})]}),e.jsxs(w,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Workflows"}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((A=s==null?void 0:s.limits)==null?void 0:A.workflows)===-1?"Unlimited":((D=s==null?void 0:s.limits)==null?void 0:D.workflows)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available workflows"})]})]}),e.jsxs(w,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"API Calls"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(($=s==null?void 0:s.limits)==null?void 0:$.api_calls)===-1?"Unlimited":((R=s==null?void 0:s.limits)==null?void 0:R.api_calls)===0?"Not Available":`${((Y=s==null?void 0:s.limits)==null?void 0:Y.api_calls)||0}/mo`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly API limit"})]})]})]}),t&&t.limit!==-1&&e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(C,{children:i.planType==="free"?"Daily Usage Limit":"Usage This Month"}),e.jsx(I,{children:i.planType==="free"?"Your daily prompt generation usage (resets every 24 hours)":"Your prompt optimization usage for the current billing period"})]}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i.planType==="free"?"Prompt Generations Today":"Prompt Optimizations"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.used," / ",t.limit]})]}),e.jsx(ee,{value:c(t.used,t.limit)}),i.planType==="free"&&t.remaining===0&&e.jsxs("div",{className:"flex flex-col gap-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-amber-600"}),e.jsx(r,{variant:"secondary",className:"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",children:"Daily Limit Reached"})]}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"You've used your 1 free prompt for today. Your limit will reset in 24 hours, or upgrade to Pro for unlimited prompts!"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(S,{variant:"default",size:"sm",onClick:o,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upgrade to Pro"]})})]}),i.planType!=="free"&&t.remaining<=5&&t.remaining>0&&e.jsx("p",{className:"text-sm text-warning",children:"You're running low on prompts. Consider upgrading your plan."}),i.planType!=="free"&&t.remaining===0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"destructive",children:"Limit Reached"}),e.jsx("p",{className:"text-sm text-destructive",children:"Upgrade your plan to continue optimizing prompts"})]}),e.jsxs(S,{variant:"default",size:"sm",onClick:o,className:"w-fit",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Pricing Plans"]})]})]})})]}),e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(C,{children:"Plan Features"}),e.jsx(I,{children:i.planType==="free"?"Your free plan includes these trial features":"Your current plan includes these features"})]}),e.jsxs(_,{children:[e.jsx("ul",{className:"space-y-2",children:i.planType==="free"?e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"1 Prompt Generation per Day"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"1 AI Agent Creation"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Basic Template Access"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Community Support"})]}),e.jsxs("li",{className:"flex items-center gap-2 opacity-50",children:[e.jsx(r,{variant:"outline",className:"bg-gray-50 text-gray-500 border-gray-200",children:"✗"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Unlimited Prompts"})]}),e.jsxs("li",{className:"flex items-center gap-2 opacity-50",children:[e.jsx(r,{variant:"outline",className:"bg-gray-50 text-gray-500 border-gray-200",children:"✗"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Advanced Workflows"})]}),e.jsxs("li",{className:"flex items-center gap-2 opacity-50",children:[e.jsx(r,{variant:"outline",className:"bg-gray-50 text-gray-500 border-gray-200",children:"✗"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Priority Support"})]})]}):e.jsxs(e.Fragment,{children:[((q=s==null?void 0:s.features)==null?void 0:q.prompt_optimization)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Unlimited Prompt Generation"})]}),((F=s==null?void 0:s.features)==null?void 0:F.advanced_workflows)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Advanced Workflows"})]}),((Z=s==null?void 0:s.features)==null?void 0:Z.compliance_checks)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Compliance Checks"})]}),((B=s==null?void 0:s.features)==null?void 0:B.team_collaboration)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Team Collaboration"})]}),((M=s==null?void 0:s.features)==null?void 0:M.priority_support)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Priority Support"})]}),((O=s==null?void 0:s.features)==null?void 0:O.dedicated_support)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Dedicated Support"})]}),((G=s==null?void 0:s.features)==null?void 0:G.custom_templates)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"Custom Templates"})]}),((W=s==null?void 0:s.features)==null?void 0:W.sso)&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✓"}),e.jsx("span",{className:"text-sm",children:"SSO Authentication"})]})]})}),i.planType==="free"&&e.jsx("div",{className:"mt-4 pt-4 border-t border-zinc-800/40",children:e.jsxs(S,{onClick:o,className:"w-full bg-black text-white hover:bg-zinc-900 font-bold border border-zinc-800 hover:border-zinc-700 transition-all duration-300",children:[e.jsx(P,{className:"w-4 h-4 mr-2",strokeWidth:2.5}),"Upgrade for Unlimited Access"]})})]})]})]})}const Ne=()=>{const a=z(),[t,p]=l.useState(null),[s,h]=l.useState(!0);return l.useEffect(()=>{const{data:{subscription:u}}=b.auth.onAuthStateChange((m,n)=>{p((n==null?void 0:n.user)??null),n||a("/auth")});return b.auth.getSession().then(({data:{session:m}})=>{p((m==null?void 0:m.user)??null),m||a("/auth"),h(!1)}),()=>u.unsubscribe()},[a]),s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-pulse-subtle",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin"})})}):e.jsx(X,{user:t,showHeader:!1,children:e.jsx("div",{className:"w-full min-h-screen bg-gradient-to-b from-background via-background to-muted/20",children:e.jsxs("div",{className:"container-responsive mx-auto max-w-6xl py-8 sm:py-12 md:py-16 lg:py-20",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 md:mb-10 lg:mb-12 space-y-2 sm:space-y-3 md:space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:"Usage Dashboard"}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg lg:text-xl text-muted-foreground max-w-2xl leading-relaxed",children:"Monitor your account usage and activity statistics"})]}),e.jsx("div",{className:"w-full",children:e.jsx(ce,{user:t})})]})})})};export{Ne as default};
